

このプロジェクトは、**人間が読んで分かりやすい設定ファイル**を中心に据えた、シンプルで直感的に扱えるタスクスケジューラシステムです。システムは主に3つのコンポーネントで構成されています。

-----

### システム概要

このスケジューラは、以下の3つの要素から成り立っています。

1.  **スケジュール管理ファイル (`tasks.yaml`)**: 「何を」「いつ」実行するかを定義する、人間が編集しやすい設定ファイル。
2.  **スケジューラ実行エンジン (`scheduler.py`)**: `tasks.yaml`を読み込み、定義されたスケジュールに従ってタスクを実行する中心的なプログラム。
3.  **タスク追加ツール (`add_task.py`)**: 対話形式で`tasks.yaml`に新しいタスクを安全に追加するための補助ツール。

-----

### 1\. スケジュール管理ファイル (`tasks.yaml`) の仕様

このファイルはシステムの心臓部であり、実行したいすべてのタスクを宣言的に管理します。

  * **役割**:
      * 実行したいタスクの一覧を定義します。
      * 各タスクの名前、実行するコマンド、そして実行スケジュールを記述します。
  * **フォーマット**:
      * 可読性が高く、シンプルな記述が可能な**YAML形式**を採用しています。
  * **構造**:
      * ルートレベルはタスクのリスト（配列）です。
      * 各タスクは以下のキーを持つオブジェクトとして定義されます。
          * `name`: タスクを識別するための一意の名前（文字列）。
          * `command`: 実行するシェルコマンドやスクリプトのパス（文字列）。
          * `schedule`: 実行タイミングを定義するオブジェクト。
  * **スケジュール (`schedule`) オブジェクトの仕様**:
      * `type`: スケジュールの種類を定義します。`every_day`, `every_week`, `every_minutes` などが利用可能です。
      * `at`: `every_day`や`every_week`と組み合わせて、実行時刻を `"HH:MM"` 形式で指定します。
      * `on`: `every_week`と組み合わせて、実行する曜日を `"monday"` のように指定します。
      * `interval`: `every_minutes`と組み合わせて、実行間隔を分単位の数値で指定します。

#### `tasks.yaml` の記述例

```yaml
- name: daily_backup
  command: python /path/to/your/backup_script.py
  schedule:
    type: every_day
    at: "02:30"

- name: weekly_report
  command: /usr/local/bin/generate-report --output /reports/weekly.csv
  schedule:
    type: every_week
    on: "monday"
    at: "09:00"

- name: frequent_data_fetch
  command: curl https://api.example.com/data
  schedule:
    type: every_minutes
    interval: 15
```

-----

### 2\. スケジューラ実行エンジン (`scheduler.py`) の仕様

このPythonスクリプトがスケジューラの本体として動作します。

  * **役割**:
      * バックグラウンドで常時実行され、`tasks.yaml`の内容に従ってタスクを起動します。
  * **主要なライブラリ**:
      * **`schedule`**: 人間にとって分かりやすい構文でジョブスケジューリングを行うためのライブラリです [1]。
      * **`subprocess`**: `command`で指定された外部コマンドやプログラムを実行するために使用します。
      * **`PyYAML`**: `tasks.yaml`ファイルを解析するために使用します。
  * **動作フロー**:
    1.  起動時に`tasks.yaml`ファイルを読み込み、内容を解析します。
    2.  解析したタスクリストをループ処理し、各タスクを`schedule`ライブラリにメモリ上のジョブとして登録します。
    3.  `schedule`ライブラリの実行ループ（例: `while True: schedule.run_pending()`）を開始し、指定された時刻が来るのを待ちます。
    4.  指定時刻になると、`schedule`ライブラリが対応する関数を呼び出します。
    5.  その関数内で`subprocess`モジュールを使い、`tasks.yaml`に記述された`command`を実行します。
  * **拡張機能（オプション）**:
      * 定期的に`tasks.yaml`ファイルの最終更新日時を監視し、ファイルに変更があった場合にスケジュールを自動で再読み込みする機能を追加することも想定されています。

-----

### 3\. タスク追加ツール (`add_task.py`) の仕様

このコマンドラインツールは、`tasks.yaml`の編集を補助し、ヒューマンエラーを防ぐことを目的としています。

  * **役割**:
      * 対話形式でユーザーに入力を促し、新しいタスクを`tasks.yaml`に簡単かつ安全に追加します。
  * **実行方法**:
      * コマンドラインから `python add_task.py` のように実行します。
  * **動作フロー**:
    1.  ツールを起動すると、ユーザーに対して「タスク名」「実行コマンド」「スケジュールの種類」などを順番に質問します。
    2.  スケジュールの種類に応じて、追加の質問（例: 「実行時刻は？」「間隔は？」）を行います。
    3.  ユーザーの回答を基に、新しいタスク情報をYAML形式で整形します。
    4.  整形したタスク情報を`tasks.yaml`ファイルの末尾に追記します。